<%= render 'layouts/frontend/header' %>

<div class="pay-container">
    <div class="step-number">
        <ul>
            <li class="step-pass"><b class="step-circle">01</b>购物车</li>
            <li class="step-on"><b class="step-circle">02</b>填写订单</li>
            <li><b class="step-circle">03</b>确认支付</li>
        </ul>
    </div>

    <%= form_for @order, url: wizard_path, method: :put do |f| %>
    <% if @order.errors.any? %>
      <% for message in @order.errors.full_messages %>
        <%= message %>
      <% end %>
    <% end %>
    <div class="box-border">
        <div class="t-bar-gray clearfloat">
            <div class="fl">收货人信息</div>
            <div class="fr font-s14 c-gray mr15">
                我们将默认顺丰快递配送
            </div>
        </div>
        <div class="padd30">
            <div class="address-form">
                <div class="address-box">
                    <ul class="address-ul">
                      <%= f.fields_for :shipping_address, @order.shipping_address do |field| %>
                        <li>
                            <%= field.text_field :name, class: 'input-style input-width', placeholder: '收货人' %>
                            <%= field.text_field :mobile, class: 'input-style input-width', placeholder: '联系电话' %>
                        </li>
                        <li>
                          <%= field.text_area :address, class: 'textarea-style', style: 'width:668px;', rows: '5', placeholder: '省份，城市，区县，街道编号/名称，楼宇名称' %>
                        </li>
                      <% end %>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="box-border">
        <div class="t-bar-gray clearfloat">
            <div class="fl">支付选项</div>
        </div>
        <!-- <div class="padd30">
            <h3 class="font-s14 c-3a">使用优惠码</h3>
            <p>
                <input type="checkbox" name="" id="coupon" value="" class="icheck" /><label for="coupon">使用优惠码</label>
            </p>
            <div id="coupon-con" class="none">
                <input type="" name="" id="" value="" size="80" class="form-input-style2 m0" style="vertical-align: middle;" />
                <input type="button" name="" id="" value="立即使用" class="btn-red2 m0" style="vertical-align: middle;" />
            </div>
        </div> -->
        <div class="line-dot"></div>
        <div class="padd30">
            <h3 class="font-s14 c-3a">预付定金</h3>
            <div class="pay-select mt20">
                <ul>
                    <!-- <li><a href="" class="">预付40%定金</a></li> -->
                    <li class="selected"><a href="" class="">全款支付</a></li>
                    <!-- <li><span class="font-s14 c-gray">使用优惠码必须全额付款</span></li> -->
                </ul>
            </div>
        </div>
    </div>

    <div class="box-border font-s14">
        <div class="t-bar-gray clearfloat">
            <div class="fl">商品及发票</div>
        </div>
        <div class="padd30">
            <h3 class="font-s14 c-3a">商品清单</h3>
            <div class="table-style mt20">
                <table width="100%" border="0" cellspacing="0" class="line-bottom">
                    <tr>
                        <th width="20%">主图</th>
                        <th>名称</th>
                        <th>价格</th>
                    </tr>
                    <% @order.line_items.each do |item| %>
                      <tr>
                          <td align="center">
                              <div class="table-imgbox">
                                <% if item.product.master.images.first %>
                                  <%= link_to image_tag(item.product.master.images.first.picture.middle.url), product_path(item.product) %>
                                <% else %>
                                  搭配钻石
                                <% end %>
                              </div>
                          </td>
                          <td align="center">
                            <% if item.product.taxons.pluck(:name).include? "钻石" %>
                              <%= show_diamond_info(item) %>
                            <% else %>
                              <%= link_to "#{item.product.name} #{item.variant.options_text}", product_path(item.product), class: 'c-3a' %>
                            <% end %>
                          </td>
                          <td align="center"><%= number_to_currency item.amount %></td>
                      </tr>
                    <% end %>
                </table>
            </div>
        </div>
        <div class="line-dot"></div>
        <div class="padd30">
            <h3 class="font-s14 c-3a">发票信息</h3>
            <div class="mt20">
                <input type="checkbox" name="" id="invoice" value="" class="icheck" /><label for="invoice">需要开发票</label>
            </div>
            <ul id="invoice-con" class="ml30 none">
                <li>
                    发票类型：普通发票 <span class="ml20">发票内容：</span>
                    <select name="" class="select-down">
                        <option value="">商品明细</option>
                    </select>
                </li>
                <li>
                    发票抬头：
                    <input type="radio" name="" value="" class="icheck" />个人
                    <input type="radio" name="" value="" class="icheck" checked />公司
                </li>
                <li class="mt20">
                    <input type="" name="" id="" value="" class="input-style" size="90" placeholder="公司名称" />
                </li>
            </ul>
        </div>
        <div class="line-dot"></div>
        <div class="padd30">
            <h3 class="font-s14 c-3a">添加订单备注</h3>
            <%=f.text_area :remark, {rows:5, class: "textarea-style mt20", placeholder: "备注内容" , style: "width: 98%;"} %>
        </div>
    </div>

    <div class="order-btnbox">
        <%= f.button '确认订单', class: 'btn-m-purple' %>
        <p class="font-s14 c-3a">商品总金额： <%= number_to_currency @order.amount %> <span class="ml20">优惠金额： -￥0</span><span class="ml20">应付金额：<b class="c-red font-s20"><%= number_to_currency @order.amount %></b></span></p>
    </div>
    <% end %>
    <%= render 'layouts/frontend/footer' %>
</div>
