<% @page_title = "填写订单信息"  %>

<%= render 'layouts/frontend/header' %>

<div class="page order-build">
    <div class="container">
        <%= render partial: 'nav', locals: {step: 2} %>
        <%= form_for @order, url: wizard_path, method: :put, data: { remote: true } do |f| %>
            <div class="section section-address">
                <div class="header">收货信息</div>
                <%= f.fields_for :shipping_address, @order.shipping_address do |field| %>
                    <main class="row">
                        <div class="col-md-7">
                            <div class="form-inline">
                                <div class="form-group">
                                    <%= field.text_field :name, class: 'form-control input-name', required: true, placeholder: '收货人姓名' %>
                                </div>
                                <div class="form-group">
                                    <%= field.text_field :mobile, class: 'form-control input-phone', required: true, placeholder: '手机号码' %>
                                </div>
                            </div>
                            <div class="form-inline">
                                <div class="city-group">
                                    <div class="form-group">
                                        <%= field.select :province, nil, {include_blank: false, required: true}, class: 'form-control city-select' do %>
                                            <%= options_for_select_with_default(field.object, :province) %>
                                        <% end %>
                                    </div>
                                    <div class="form-group">
                                        <%= field.select :city, nil, {include_blank: false, required: true}, class: 'form-control city-select' do %>
                                            <%= options_for_select_with_default(field.object, :city) %>
                                        <% end %>
                                    </div>
                                    <div class="form-group">
                                        <%= field.select :district, nil, {include_blank: false, required: true}, class: 'form-control city-select' do %>
                                            <%= options_for_select_with_default(field.object, :district) %>
                                        <% end %>
                                    </div>
                                </div>
                            </div>
                            <div class="form-inline">
                                <div class="form-group">
                                    <%= field.text_field :address, class: 'form-control input-address', required: true, placeholder: '街道编号/名称，楼宇名称' %>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <h4>配送说明</h4>
                            <p>VANDODO产品目前仅限在中国大陆地区购买。您订购的商品将通过顺丰速运配送，顺丰无法送达的地区将改用其他快递公司，您订购的产品我们将按产品总额全额投保。<br>
                            配送时间：星期一至星期日 下午 5:30</p>
                        </div>
                    </main>
                <% end %>
            </div>

            <div class="section section-coupon">
                <div class="header">优惠码</div>
                <main>
                    <div class="form-inline">
                        <div class="form-group">
                            <label>使用优惠码</label>
                            <div class="input-group">
                                <input type="text" name="" class="form-control" disabled>
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button">立即使用</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <div class="section section-invoice">
                <div class="header">发票信息</div>
                <main>
                    <div class="form-inline">
                        <div class="form-group">
                            <div class="checkbox">
                                <label>
                                    <input name="order[need_invoice]" type="checkbox" value="0"> 需要发票
                                </label>
                            </div>
                        </div>
                        <span class="form-group-invoice">
                            <div class="form-group">发票类型：普通发票</div>
                            <div class="form-group">发票内容：商品明细</div>
                            <div class="form-group">
                                发票抬头：
                                <label class="radio-inline">
                                    <input type="radio" name="order[invoice_type]" value="0" checked> 个人
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="order[invoice_type]" value="1"> 公司
                                </label>
                                <div class="form-group form-group-title">
                                    <input type="text" name="order[invoice_title]" class="form-control" placeholder="输入公司名称">
                                </div>
                            </div>
                        </span>
                    </div>
                </main>
            </div>

            <div class="section section-items">
                <div class="header">商品信息</div>
                <main>
                    <div class="order-items-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="name">商品/规格</th>
                                    <th>数量</th>
                                    <th>金额</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% @order.line_items.rings.each do |item| %>
                                    <tr data-item="<%= item.id %>">
                                        <th width="100"><img src="<%= item.product.master.images.first.picture.mini.url rescue '' %>"></th>
                                        <td class="name">
                                            <%= item.name %> <span><%= item.variant.options_text %> <%= show_properties(item) %> <%= show_diamond_info(item.diamond) %></span>
                                        </td>
                                        <td class="quantity"><%= item.quantity %></td>
                                        <td class="price"><%= item.final_amount.to_i %></td>
                                    </tr>
                                <% end %>
                            </tbody>
                        </table>
                    </div>
                </main>
            </div>

            <div class="order-payment">
                <p>
                    <span>商品总金额：<%= number_to_currency @order.item_total %></span> 　　
                    <span>优惠金额：¥0</span>　　
                    <span>运费：¥0</span> 　　
                    <span>支付方式：在线支付</span>　　
                    <span>应付金额：<span class="price"><%= number_to_currency @order.total %></span></span>
                </p>
                <p class="right">
                    <button type="submit" class="btn btn-default btn-lg" data-disable-with="正在提交...">提交订单</button>
                </p>
            </div>
        <% end %>
    </div>
</div>

<%= render 'layouts/frontend/footer' %>
